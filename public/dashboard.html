<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Fleek ‚Äî NPS Admin Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0c0c0c;--surface:#141414;--card:#1a1a1a;--border:#272727;--border2:#333;--yellow:#F5C518;--red:#E8453C;--red-dim:rgba(232,69,60,.13);--green:#3DD68C;--green-dim:rgba(61,214,140,.12);--orange:#F07C3A;--blue:#5B9EF5;--text:#ededed;--muted:#999;--subtle:#666}
body{background:var(--bg);color:var(--text);font-family:'Syne',sans-serif;font-size:14px;min-height:100vh}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
.rev{opacity:0;animation:fadeUp .5s ease forwards}
header{background:var(--surface);border-bottom:1px solid var(--border);padding:14px 36px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;gap:12px}
.logo{display:flex;align-items:center;gap:9px}
.logo-name{font-family:'Bebas Neue',sans-serif;font-size:22px;letter-spacing:4px;color:var(--yellow)}
.badge-admin{background:rgba(245,197,24,.15);color:var(--yellow);border:1px solid rgba(245,197,24,.3);padding:3px 9px;border-radius:4px;font-family:'JetBrains Mono',monospace;font-size:9px;letter-spacing:1px}
.hdr-right{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.btn-sm{background:transparent;border:1px solid var(--border2);color:var(--muted);padding:6px 12px;border-radius:6px;cursor:pointer;font-family:'Syne',sans-serif;font-size:11px;font-weight:700;transition:all .2s;text-decoration:none;display:inline-block}
.btn-sm:hover{border-color:var(--yellow);color:var(--yellow)}
.btn-danger:hover{border-color:var(--red)!important;color:var(--red)!important}
.nav{background:var(--surface);border-bottom:1px solid var(--border);padding:0 36px;display:flex;overflow-x:auto}
.ntab{padding:12px 16px;font-family:'JetBrains Mono',monospace;font-size:9px;letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;background:none;border-top:none;border-left:none;border-right:none;white-space:nowrap;transition:all .2s}
.ntab:hover{color:var(--text)}
.ntab.active{color:var(--yellow);border-bottom-color:var(--yellow)}
.page{padding:24px 36px;max-width:1400px;margin:0 auto}
.tc{display:none}.tc.active{display:block}
.stag{font-family:'JetBrains Mono',monospace;font-size:9px;letter-spacing:3px;color:var(--yellow);text-transform:uppercase;margin-bottom:4px}
.stitle{font-family:'Bebas Neue',sans-serif;font-size:24px;letter-spacing:1px;margin-bottom:18px}
.sdiv{border:none;border-top:1px solid var(--border);margin:32px 0 24px}
.rb{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;margin-bottom:18px}
/* stats */
.sr{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin-bottom:20px}
.sc{background:var(--card);border:1px solid var(--border);border-radius:11px;padding:16px}
.sc.hl{border-color:var(--yellow);background:linear-gradient(135deg,#1e1c10,#1a1a1a)}
.sc-lbl{font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:2px;color:var(--muted);text-transform:uppercase;margin-bottom:6px}
.sc-val{font-family:'Bebas Neue',sans-serif;font-size:36px;line-height:1}
.sc-sub{font-size:10px;color:var(--subtle);margin-top:2px}
/* charts */
.g2{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-bottom:18px}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;margin-bottom:18px}
@media(max-width:860px){.g2,.g3{grid-template-columns:1fr}}
.cc{background:var(--card);border:1px solid var(--border);border-radius:11px;padding:20px}
.cc h3{font-family:'Bebas Neue',sans-serif;font-size:14px;letter-spacing:1px;color:var(--muted);margin-bottom:14px}
/* geo cards */
.geo-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:14px;margin-bottom:18px}
.gc{background:var(--card);border:1px solid var(--border);border-radius:11px;padding:18px}
.gc-flag{font-size:20px;margin-bottom:5px}
.gc-name{font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1px;margin-bottom:2px}
.gc-nps{font-family:'Bebas Neue',sans-serif;font-size:32px;line-height:1;margin-bottom:3px}
.gc-meta{font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--muted);letter-spacing:1px;margin-bottom:10px}
.bar-row{display:flex;align-items:center;gap:5px;margin-bottom:3px}
.bar-lbl{font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--muted);width:52px}
.bar-bg{flex:1;height:4px;background:var(--border2);border-radius:999px;overflow:hidden}
.bar-fill{height:100%;border-radius:999px}
.bar-pct{font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--muted);width:26px;text-align:right}
/* region table */
.rtbl{width:100%;border-collapse:collapse;margin-bottom:18px}
.rtbl th{text-align:left;font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:2px;color:var(--subtle);text-transform:uppercase;padding:10px 12px;border-bottom:1px solid var(--border);background:var(--surface)}
.rtbl td{padding:10px 12px;border-bottom:1px solid var(--border);font-size:12px}
.rtbl tr:last-child td{background:rgba(245,197,24,.03);font-weight:700}
.nb{font-family:'Bebas Neue',sans-serif;font-size:15px;padding:2px 7px;border-radius:4px}
.npos{background:var(--green-dim);color:var(--green)}
.nneg{background:var(--red-dim);color:var(--red)}
.nneu{background:rgba(245,197,24,.12);color:var(--yellow)}
/* dept */
.dg{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px;margin-bottom:18px}
.dc{background:var(--card);border:1px solid var(--border);border-radius:11px;padding:18px}
.dc-name{font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1px;margin-bottom:2px}
.dc-nps{font-family:'Bebas Neue',sans-serif;font-size:30px;line-height:1;margin-bottom:3px}
/* sat */
.sat-row{padding:12px 0;border-bottom:1px solid var(--border)}
.sat-row:last-child{border-bottom:none}
.sat-name{font-size:12px;font-weight:700;margin-bottom:1px}
.sat-meta{font-size:10px;color:var(--muted);margin-bottom:7px}
.sat-bar{display:flex;height:5px;border-radius:999px;overflow:hidden;gap:1px}
/* tables */
.tw{background:var(--card);border:1px solid var(--border);border-radius:11px;overflow:hidden;margin-bottom:18px}
.th2{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.th2 h3{font-family:'Bebas Neue',sans-serif;font-size:14px;letter-spacing:1px;color:var(--muted)}
table{width:100%;border-collapse:collapse}
th{text-align:left;font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:2px;color:var(--subtle);text-transform:uppercase;padding:9px 12px;border-bottom:1px solid var(--border)}
td{padding:10px 12px;border-bottom:1px solid var(--border);font-size:11px}
tr:last-child td{border-bottom:none}
tr:hover td{background:rgba(255,255,255,.015)}
.bdg{display:inline-block;padding:2px 6px;border-radius:3px;font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:1px;font-weight:700;text-transform:uppercase}
.b-pro{background:var(--green-dim);color:var(--green)}.b-pas{background:rgba(245,197,24,.12);color:var(--yellow)}.b-det{background:var(--red-dim);color:var(--red)}
/* upload */
.uz{border:2px dashed var(--border2);border-radius:11px;padding:32px;text-align:center;cursor:pointer;transition:all .2s;background:var(--card);margin-bottom:14px}
.uz:hover,.uz.drag{border-color:var(--yellow);background:rgba(245,197,24,.03)}
.uz-icon{font-size:26px;margin-bottom:8px}
.uz-title{font-family:'Bebas Neue',sans-serif;font-size:17px;letter-spacing:1px;margin-bottom:3px}
.uz-sub{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--muted);letter-spacing:1px}
.btn-y{background:var(--yellow);color:#0c0c0c;border:none;padding:8px 18px;border-radius:6px;font-weight:800;font-size:11px;letter-spacing:1px;text-transform:uppercase;cursor:pointer;font-family:'Syne',sans-serif;transition:opacity .2s;margin-top:10px}
.btn-y:hover{opacity:.88}
.csv-hint{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:12px;margin-bottom:14px;font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--muted)}
.csv-hint code{color:var(--yellow);display:block;margin-top:4px;font-size:10px}
/* problems */
.pr{display:flex;align-items:center;gap:12px;padding:11px 0;border-bottom:1px solid var(--border)}
.pr:last-child{border-bottom:none}
.pr-rk{font-family:'Bebas Neue',sans-serif;font-size:20px;color:var(--yellow);width:26px;flex-shrink:0}
.pr-name{font-weight:700;font-size:12px;margin-bottom:1px}
.pr-desc{font-size:10px;color:var(--muted)}
.imp{font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:1px;padding:2px 6px;border-radius:3px;flex-shrink:0}
.i-crit{background:var(--red-dim);color:var(--red)}.i-high{background:rgba(240,124,58,.13);color:var(--orange)}.i-med{background:rgba(91,158,245,.12);color:var(--blue)}
.pr-pct{font-family:'Bebas Neue',sans-serif;font-size:18px;margin-left:auto;flex-shrink:0}
/* form link */
.form-box{background:var(--surface);border:1px solid var(--yellow);border-radius:10px;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;gap:14px;margin-bottom:18px;flex-wrap:wrap}
.form-url{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--yellow);word-break:break-all}
/* toast */
.toast{position:fixed;bottom:18px;right:18px;background:var(--green);color:#0c0c0c;padding:9px 16px;border-radius:8px;font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:700;letter-spacing:1px;z-index:999;transform:translateY(60px);transition:transform .3s}
.toast.show{transform:translateY(0)}
.empty{text-align:center;padding:40px 20px;color:var(--subtle);font-family:'JetBrains Mono',monospace;font-size:10px}
sel{background:var(--card);border:1px solid var(--border2);color:var(--text);padding:7px 11px;border-radius:6px;font-family:'JetBrains Mono',monospace;font-size:9px;cursor:pointer;outline:none}
.auto-badge{background:rgba(61,214,140,.12);color:var(--green);border:1px solid rgba(61,214,140,.25);padding:3px 9px;border-radius:4px;font-family:'JetBrains Mono',monospace;font-size:9px;letter-spacing:1px;margin-left:8px}
</style>
</head>
<body>
<header>
  <div class="logo">
    <svg width="24" height="24" viewBox="0 0 24 24"><rect width="24" height="24" rx="5" fill="#F5C518"/><text x="12" y="17" text-anchor="middle" font-size="13" font-weight="900" fill="#0c0c0c">‚ö°</text></svg>
    <span class="logo-name">FLEEK</span>
    <span style="font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--muted);letter-spacing:1px">NPS ADMIN</span>
  </div>
  <div class="hdr-right">
    <a href="/form" target="_blank" class="btn-sm">üìã Survey Form</a>
    <span class="badge-admin">ADMIN</span>
    <button class="btn-sm btn-danger" onclick="logout()">Logout</button>
  </div>
</header>

<div class="nav">
  <button class="ntab active" onclick="sw('overview')" id="nt-overview">Overview</button>
  <button class="ntab" onclick="sw('geo')" id="nt-geo">Geography</button>
  <button class="ntab" onclick="sw('departments')" id="nt-departments">Departments</button>
  <button class="ntab" onclick="sw('history')" id="nt-history">History</button>
  <button class="ntab" onclick="sw('upload')" id="nt-upload">Upload CSV</button>
  <button class="ntab" onclick="sw('responses')" id="nt-responses">Responses</button>
</div>

<div class="page">

<!-- OVERVIEW -->
<div class="tc active" id="tab-overview">
  <div class="rb rev">
    <div>
      <div class="stag">Fleek ¬∑ Seller NPS ¬∑ <span id="cur-period">All Time</span></div>
      <div class="stitle" style="margin-bottom:0">Dashboard Overview</div>
    </div>
    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
      <select id="pf" onchange="applyFilter()" style="background:var(--card);border:1px solid var(--border2);color:var(--text);padding:7px 11px;border-radius:6px;font-family:'JetBrains Mono',monospace;font-size:9px;cursor:pointer;outline:none"><option value="all">All Periods</option></select>
      <button class="btn-y" onclick="sw('upload')">+ Import CSV</button>
    </div>
  </div>

  <div class="sr rev">
    <div class="sc hl"><div class="sc-lbl">Overall NPS</div><div class="sc-val" id="ov-nps" style="color:var(--red)">‚Äì3</div><div class="sc-sub" id="ov-ctx">Sep 2025 + Nov 2025 + Jan 2026</div></div>
    <div class="sc"><div class="sc-lbl">Jan 2026 NPS</div><div class="sc-val" style="color:var(--yellow)">+1</div><div class="sc-sub">147 respondents</div></div>
    <div class="sc"><div class="sc-lbl">Promoters</div><div class="sc-val" id="ov-pro" style="color:var(--green)">‚Äî</div><div class="sc-sub" id="ov-pro-s">‚Äî</div></div>
    <div class="sc"><div class="sc-lbl">Passives</div><div class="sc-val" id="ov-pass" style="color:var(--yellow)">‚Äî</div><div class="sc-sub" id="ov-pass-s">‚Äî</div></div>
    <div class="sc"><div class="sc-lbl">Detractors</div><div class="sc-val" id="ov-det" style="color:var(--red)">‚Äî</div><div class="sc-sub" id="ov-det-s">‚Äî</div></div>
    <div class="sc"><div class="sc-lbl">Total Responses</div><div class="sc-val" id="ov-tot" style="color:var(--text)">‚Äî</div><div class="sc-sub">respondents</div></div>
  </div>

  <div class="g2 rev">
    <div class="cc"><h3>Score Distribution ‚Äî Jan 2026</h3><canvas id="distChart" height="200"></canvas></div>
    <div class="cc"><h3>Segment Breakdown ‚Äî Jan 2026</h3><canvas id="segChart" height="200"></canvas></div>
  </div>
  <div class="cc rev" style="margin-bottom:18px"><h3>NPS Trend: Sep 2025 ‚Üí Now</h3><canvas id="trendChart" height="90"></canvas></div>

  <div class="rev">
    <div class="stag">Jan 2026 ¬∑ Verbatim Feedback</div>
    <div class="stitle">Top 5 Issues Driving Detractors</div>
    <div class="cc">
      <div class="pr"><div class="pr-rk">01</div><div><div class="pr-name">Refund Policy</div><div class="pr-desc">Perceived as unfair to sellers ‚Äî most cited issue by far</div></div><span class="imp i-crit">CRITICAL</span><div class="pr-pct" style="color:var(--red)">33.3%</div></div>
      <div class="pr"><div class="pr-rk">02</div><div><div class="pr-name">Seller Support</div><div class="pr-desc">Slow response times, unhelpful resolutions</div></div><span class="imp i-high">HIGH</span><div class="pr-pct" style="color:var(--orange)">25.2%</div></div>
      <div class="pr"><div class="pr-rk">03</div><div><div class="pr-name">Quality Check</div><div class="pr-desc">Inconsistent QC ‚Äî items wrongly flagged or rejected</div></div><span class="imp i-high">HIGH</span><div class="pr-pct" style="color:var(--orange)">19.0%</div></div>
      <div class="pr"><div class="pr-rk">04</div><div><div class="pr-name">Vendor App</div><div class="pr-desc">Performance issues, crashes, poor UX</div></div><span class="imp i-high">HIGH</span><div class="pr-pct" style="color:var(--orange)">17.7%</div></div>
      <div class="pr"><div class="pr-rk">05</div><div><div class="pr-name">Sales &amp; Visibility</div><div class="pr-desc">New sellers struggle with discoverability</div></div><span class="imp i-med">MEDIUM</span><div class="pr-pct" style="color:var(--blue)">17.7%</div></div>
    </div>
  </div>
</div>

<!-- GEO -->
<div class="tc" id="tab-geo">
  <div class="stag">Regional Breakdown ¬∑ Jan 2026</div>
  <div class="stitle">NPS by Geography</div>
  <div class="geo-grid rev">
    <div class="gc" style="border-color:rgba(91,158,245,.35)">
      <div class="gc-flag">üáµüá∞</div><div class="gc-name">PK Zone</div>
      <div class="gc-nps" style="color:var(--red)">‚Äì9</div>
      <div class="gc-meta">11 SELLERS ¬∑ $164K DEC GMV ¬∑ $792K L3</div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--green)">Promoters</span><div class="bar-bg"><div class="bar-fill" style="width:9%;background:var(--green)"></div></div><span class="bar-pct">9%</span></div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--yellow)">Passives</span><div class="bar-bg"><div class="bar-fill" style="width:73%;background:var(--yellow)"></div></div><span class="bar-pct">73%</span></div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--red)">Detractors</span><div class="bar-bg"><div class="bar-fill" style="width:18%;background:var(--red)"></div></div><span class="bar-pct">18%</span></div>
      <div style="margin-top:8px;font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--subtle)">1 promoter ¬∑ 8 passives ¬∑ 2 detractors</div>
    </div>
    <div class="gc" style="border-color:rgba(61,214,140,.3)">
      <div class="gc-flag">üáµüá∞</div><div class="gc-name">PK Non-Zone</div>
      <div class="gc-nps" style="color:var(--green)">+4</div>
      <div class="gc-meta">122 SELLERS ¬∑ $748K DEC GMV ¬∑ $2.55M L3</div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--green)">Promoters</span><div class="bar-bg"><div class="bar-fill" style="width:39%;background:var(--green)"></div></div><span class="bar-pct">39%</span></div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--yellow)">Passives</span><div class="bar-bg"><div class="bar-fill" style="width:25%;background:var(--yellow)"></div></div><span class="bar-pct">25%</span></div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--red)">Detractors</span><div class="bar-bg"><div class="bar-fill" style="width:35%;background:var(--red)"></div></div><span class="bar-pct">35%</span></div>
      <div style="margin-top:8px;font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--subtle)">48 promoters ¬∑ 31 passives ¬∑ 43 detractors</div>
    </div>
    <div class="gc" style="border-color:rgba(240,124,58,.3)">
      <div class="gc-flag">üåè</div><div class="gc-name">India &amp; ROW</div>
      <div class="gc-nps" style="color:var(--red)">‚Äì14</div>
      <div class="gc-meta">14 SELLERS ¬∑ $110K DEC GMV ¬∑ $332K L3</div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--green)">Promoters</span><div class="bar-bg"><div class="bar-fill" style="width:29%;background:var(--green)"></div></div><span class="bar-pct">29%</span></div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--yellow)">Passives</span><div class="bar-bg"><div class="bar-fill" style="width:29%;background:var(--yellow)"></div></div><span class="bar-pct">29%</span></div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--red)">Detractors</span><div class="bar-bg"><div class="bar-fill" style="width:43%;background:var(--red)"></div></div><span class="bar-pct">43%</span></div>
      <div style="margin-top:8px;font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--subtle)">4 promoters ¬∑ 4 passives ¬∑ 6 detractors</div>
    </div>
  </div>

  <div class="g2 rev">
    <div class="cc"><h3>Regional NPS Comparison ‚Äî Jan 2026</h3><canvas id="geoChart" height="180"></canvas></div>
    <div class="cc"><h3>Dec GMV by Region ($K)</h3><canvas id="gmvChart" height="180"></canvas></div>
  </div>

  <div class="tw rev">
    <div class="th2"><h3>Regional Detail Table ‚Äî Jan 2026</h3></div>
    <table class="rtbl">
      <thead><tr><th>Region</th><th>Sellers</th><th>Promoters</th><th>Passives</th><th>Detractors</th><th>NPS</th><th>Dec GMV</th><th>L3 GMV</th></tr></thead>
      <tbody>
        <tr><td>üáµüá∞ PK Zone</td><td>11</td><td style="color:var(--green)">1 (9%)</td><td style="color:var(--yellow)">8 (73%)</td><td style="color:var(--red)">2 (18%)</td><td><span class="nb nneg">‚Äì9</span></td><td>$164K</td><td>$792K</td></tr>
        <tr><td>üáµüá∞ PK Non-Zone</td><td>122</td><td style="color:var(--green)">48 (39%)</td><td style="color:var(--yellow)">31 (25%)</td><td style="color:var(--red)">43 (35%)</td><td><span class="nb npos">+4</span></td><td>$748K</td><td>$2.55M</td></tr>
        <tr><td>üåè India &amp; ROW</td><td>14</td><td style="color:var(--green)">4 (29%)</td><td style="color:var(--yellow)">4 (29%)</td><td style="color:var(--red)">6 (43%)</td><td><span class="nb nneg">‚Äì14</span></td><td>$110K</td><td>$332K</td></tr>
        <tr><td style="font-family:'Bebas Neue',sans-serif;font-size:14px;letter-spacing:1px;color:var(--yellow)">TOTAL</td><td style="font-family:'Bebas Neue',sans-serif">147</td><td style="color:var(--green)">53 (36%)</td><td style="color:var(--yellow)">43 (29%)</td><td style="color:var(--red)">51 (35%)</td><td><span class="nb nneu">+1</span></td><td>$1.02M</td><td>$3.68M</td></tr>
      </tbody>
    </table>
  </div>

  <div style="background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px 20px;margin-bottom:18px" class="rev">
    <div style="font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:2px;color:var(--muted);margin-bottom:4px">REVENUE AT RISK ANALYSIS</div>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-top:10px">
      <div><div style="font-size:10px;color:var(--muted);margin-bottom:2px">Promoters GMV</div><div style="font-family:'Bebas Neue',sans-serif;font-size:26px;color:var(--green)">$278K</div><div style="font-size:9px;color:var(--subtle)">53 sellers ¬∑ 27.2% of GMV</div></div>
      <div><div style="font-size:10px;color:var(--muted);margin-bottom:2px">Passives GMV</div><div style="font-family:'Bebas Neue',sans-serif;font-size:26px;color:var(--yellow)">$380K</div><div style="font-size:9px;color:var(--subtle)">43 sellers ¬∑ 37.2% ¬∑ watching</div></div>
      <div><div style="font-size:10px;color:var(--muted);margin-bottom:2px">Detractors GMV</div><div style="font-family:'Bebas Neue',sans-serif;font-size:26px;color:var(--red)">$365K</div><div style="font-size:9px;color:var(--subtle)">51 sellers ¬∑ 35.7% ¬∑ at risk</div></div>
      <div><div style="font-size:10px;color:var(--muted);margin-bottom:2px">Total Dec GMV</div><div style="font-family:'Bebas Neue',sans-serif;font-size:26px;color:var(--yellow)">$1.02M</div><div style="font-size:9px;color:var(--subtle)">L3 GMV: $3.68M</div></div>
    </div>
  </div>
</div>

<!-- DEPARTMENTS -->
<div class="tc" id="tab-departments">
  <div class="stag">Operational Analysis ¬∑ Jan 2026</div>
  <div class="stitle">NPS by Department</div>
  <div class="dg rev">
    <div class="dc"><div class="dc-name">Seller Support</div><div class="dc-nps" style="color:var(--orange)">‚Äì18</div><div style="font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--muted);margin-bottom:8px">OPPORTUNITY ¬∑ HIGHEST VOLUME</div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--green)">Pro</span><div class="bar-bg"><div class="bar-fill" style="width:25%;background:var(--green)"></div></div><span class="bar-pct">25%</span></div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--yellow)">Pass</span><div class="bar-bg"><div class="bar-fill" style="width:32%;background:var(--yellow)"></div></div><span class="bar-pct">32%</span></div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--red)">Det</span><div class="bar-bg"><div class="bar-fill" style="width:43%;background:var(--red)"></div></div><span class="bar-pct">43%</span></div>
    </div>
    <div class="dc"><div class="dc-name">Quality Check</div><div class="dc-nps" style="color:var(--yellow)">‚Äì5</div><div style="font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--muted);margin-bottom:8px">MIXED ¬∑ NEEDS CONSISTENCY</div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--green)">Pro</span><div class="bar-bg"><div class="bar-fill" style="width:30%;background:var(--green)"></div></div><span class="bar-pct">30%</span></div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--yellow)">Pass</span><div class="bar-bg"><div class="bar-fill" style="width:35%;background:var(--yellow)"></div></div><span class="bar-pct">35%</span></div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--red)">Det</span><div class="bar-bg"><div class="bar-fill" style="width:35%;background:var(--red)"></div></div><span class="bar-pct">35%</span></div>
    </div>
    <div class="dc"><div class="dc-name">Refund Policy</div><div class="dc-nps" style="color:var(--red)">‚Äì22</div><div style="font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--muted);margin-bottom:8px">CRITICAL ¬∑ MOST CITED</div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--green)">Pro</span><div class="bar-bg"><div class="bar-fill" style="width:13%;background:var(--green)"></div></div><span class="bar-pct">13%</span></div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--yellow)">Pass</span><div class="bar-bg"><div class="bar-fill" style="width:32%;background:var(--yellow)"></div></div><span class="bar-pct">32%</span></div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--red)">Det</span><div class="bar-bg"><div class="bar-fill" style="width:55%;background:var(--red)"></div></div><span class="bar-pct">55%</span></div>
    </div>
    <div class="dc"><div class="dc-name">Payments</div><div class="dc-nps" style="color:var(--blue)">+10</div><div style="font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--muted);margin-bottom:8px">STRENGTH ¬∑ VALUED MOST</div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--green)">Pro</span><div class="bar-bg"><div class="bar-fill" style="width:51%;background:var(--green)"></div></div><span class="bar-pct">51%</span></div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--yellow)">Pass</span><div class="bar-bg"><div class="bar-fill" style="width:21%;background:var(--yellow)"></div></div><span class="bar-pct">21%</span></div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--red)">Det</span><div class="bar-bg"><div class="bar-fill" style="width:28%;background:var(--red)"></div></div><span class="bar-pct">28%</span></div>
    </div>
    <div class="dc"><div class="dc-name">Vendor App</div><div class="dc-nps" style="color:var(--red)">‚Äì20</div><div style="font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--muted);margin-bottom:8px">HIGH PRIORITY</div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--green)">Pro</span><div class="bar-bg"><div class="bar-fill" style="width:18%;background:var(--green)"></div></div><span class="bar-pct">18%</span></div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--yellow)">Pass</span><div class="bar-bg"><div class="bar-fill" style="width:31%;background:var(--yellow)"></div></div><span class="bar-pct">31%</span></div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--red)">Det</span><div class="bar-bg"><div class="bar-fill" style="width:51%;background:var(--red)"></div></div><span class="bar-pct">51%</span></div>
    </div>
    <div class="dc"><div class="dc-name">Shipping &amp; Logistics</div><div class="dc-nps" style="color:var(--green)">+40</div><div style="font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--muted);margin-bottom:8px">STRENGTH ¬∑ CONTINUE</div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--green)">Pro</span><div class="bar-bg"><div class="bar-fill" style="width:56%;background:var(--green)"></div></div><span class="bar-pct">56%</span></div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--yellow)">Pass</span><div class="bar-bg"><div class="bar-fill" style="width:28%;background:var(--yellow)"></div></div><span class="bar-pct">28%</span></div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--red)">Det</span><div class="bar-bg"><div class="bar-fill" style="width:16%;background:var(--red)"></div></div><span class="bar-pct">16%</span></div>
    </div>
    <div class="dc"><div class="dc-name">Sales &amp; Visibility</div><div class="dc-nps" style="color:var(--yellow)">+10</div><div style="font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--muted);margin-bottom:8px">CORE VALUE</div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--green)">Pro</span><div class="bar-bg"><div class="bar-fill" style="width:43%;background:var(--green)"></div></div><span class="bar-pct">43%</span></div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--yellow)">Pass</span><div class="bar-bg"><div class="bar-fill" style="width:39%;background:var(--yellow)"></div></div><span class="bar-pct">39%</span></div>
      <div class="bar-row"><span class="bar-lbl" style="color:var(--red)">Det</span><div class="bar-bg"><div class="bar-fill" style="width:18%;background:var(--red)"></div></div><span class="bar-pct">18%</span></div>
    </div>
  </div>
  <div class="cc rev" style="margin-bottom:18px"><h3>Department NPS Chart</h3><canvas id="deptChart" height="100"></canvas></div>
  <div class="sdiv"></div>
  <div class="stag rev">Operational Satisfaction ¬∑ Jan 2026</div><div class="stitle rev">Satisfaction by Area</div>
  <div class="cc rev">
    <div class="sat-row"><div class="sat-name">Payment System <span style="float:right;font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--green)">STRENGTH</span></div><div class="sat-meta">63.3% satisfied ¬∑ 21.1% neutral ¬∑ 15.6% dissatisfied</div><div class="sat-bar"><div style="width:63.3%;background:var(--green)"></div><div style="width:21.1%;background:var(--yellow)"></div><div style="width:15.6%;background:var(--red)"></div></div></div>
    <div class="sat-row"><div class="sat-name">Shipping &amp; Logistics <span style="float:right;font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--green)">STRENGTH</span></div><div class="sat-meta">55.9% satisfied ¬∑ 28.3% neutral ¬∑ 15.9% dissatisfied</div><div class="sat-bar"><div style="width:55.9%;background:var(--green)"></div><div style="width:28.3%;background:var(--yellow)"></div><div style="width:15.9%;background:var(--red)"></div></div></div>
    <div class="sat-row"><div class="sat-name">Vendor Application <span style="float:right;font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--orange)">MEDIUM</span></div><div class="sat-meta">49.0% satisfied ¬∑ 33.3% neutral ¬∑ 17.7% dissatisfied</div><div class="sat-bar"><div style="width:49%;background:var(--green)"></div><div style="width:33.3%;background:var(--yellow)"></div><div style="width:17.7%;background:var(--red)"></div></div></div>
    <div class="sat-row"><div class="sat-name">Quality Check <span style="float:right;font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--orange)">MEDIUM</span></div><div class="sat-meta">48.3% satisfied ¬∑ 33.3% neutral ¬∑ 18.4% dissatisfied</div><div class="sat-bar"><div style="width:48.3%;background:var(--green)"></div><div style="width:33.3%;background:var(--yellow)"></div><div style="width:18.4%;background:var(--red)"></div></div></div>
    <div class="sat-row"><div class="sat-name">Seller Support <span style="float:right;font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--orange)">HIGH</span></div><div class="sat-meta">45.6% satisfied ¬∑ 29.3% neutral ¬∑ 25.2% dissatisfied</div><div class="sat-bar"><div style="width:45.6%;background:var(--green)"></div><div style="width:29.3%;background:var(--yellow)"></div><div style="width:25.2%;background:var(--red)"></div></div></div>
    <div class="sat-row"><div class="sat-name">Sales &amp; Visibility <span style="float:right;font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--orange)">MEDIUM</span></div><div class="sat-meta">43.5% satisfied ¬∑ 38.8% neutral ¬∑ 17.7% dissatisfied</div><div class="sat-bar"><div style="width:43.5%;background:var(--green)"></div><div style="width:38.8%;background:var(--yellow)"></div><div style="width:17.7%;background:var(--red)"></div></div></div>
    <div class="sat-row"><div class="sat-name">Refund Process <span style="float:right;font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--red)">CRITICAL</span></div><div class="sat-meta">32% satisfied ¬∑ 34% neutral ¬∑ 34% dissatisfied</div><div class="sat-bar"><div style="width:32%;background:var(--green)"></div><div style="width:34%;background:var(--yellow)"></div><div style="width:34%;background:var(--red)"></div></div></div>
    <div style="display:flex;gap:14px;margin-top:10px;font-size:10px;color:var(--muted)"><span>üü¢ Satisfied</span><span>üü° Neutral</span><span>üî¥ Dissatisfied</span></div>
  </div>
</div>

<!-- HISTORY -->
<div class="tc" id="tab-history">
  <div style="display:flex;align-items:center;gap:10px;margin-bottom:18px">
    <div><div class="stag">Historical Tracking</div><div class="stitle" style="margin-bottom:0">NPS Over All Periods</div></div>
    <span class="auto-badge">Auto-updates with new imports</span>
  </div>
  <div class="cc rev" style="margin-bottom:18px"><h3>Historical NPS Trend</h3><canvas id="histChart" height="100"></canvas></div>
  <div class="tw rev"><div class="th2"><h3>Period Summary</h3></div><div id="hist-tbl"></div></div>
</div>

<!-- UPLOAD -->
<div class="tc" id="tab-upload">
  <div class="stag">Data Import</div><div class="stitle">Upload NPS Survey CSV</div>
  <div class="form-box rev">
    <div>
      <div style="font-family:'JetBrains Mono',monospace;font-size:8px;letter-spacing:2px;color:var(--muted);margin-bottom:3px">üìã SURVEY FORM ‚Äî SHARE THIS LINK WITH SELLERS</div>
      <div class="form-url">https://fleek-nps-dashboard.vercel.app/form</div>
      <div style="font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--subtle);margin-top:3px">Auto-send last week of each month ¬∑ responses recorded instantly</div>
    </div>
    <button class="btn-y" onclick="navigator.clipboard.writeText('https://fleek-nps-dashboard.vercel.app/form');showToast('‚úì Link copied!')">Copy Link</button>
  </div>
  <div class="csv-hint rev"><strong>CSV Format:</strong><code>seller, score, comment, department, region, period</code><div style="margin-top:4px;font-size:9px">region: "PK Zone" | "PK Non-Zone" | "India" | "ROW" ¬∑ score: integer 0‚Äì10</div></div>
  <div class="uz rev" id="uz" onclick="document.getElementById('fi').click()" ondragover="ev(event)" ondrop="drop(event)">
    <div class="uz-icon">üìÇ</div><div class="uz-title">Drop CSV Here or Click to Browse</div>
    <div class="uz-sub">Each upload merges into the historical record</div>
    <button class="btn-y" onclick="event.stopPropagation()">Choose File</button>
  </div>
  <input type="file" id="fi" accept=".csv" style="display:none" onchange="handleCSV(this.files[0])"/>
  <div id="upload-prev" style="display:none;margin-top:14px">
    <div class="tw"><div class="th2" style="display:flex;align-items:center;justify-content:space-between"><h3 id="prev-title">Preview</h3><button class="btn-y" onclick="confirmUpload()">‚úì Import</button></div><div id="prev-tbl"></div></div>
  </div>
  <div class="tw rev" style="margin-top:18px"><div class="th2"><h3>Upload History</h3><span id="up-count" style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--muted)">0</span></div><div id="up-log"><div class="empty">No uploads yet</div></div></div>
</div>

<!-- RESPONSES -->
<div class="tc" id="tab-responses">
  <div class="rb">
    <div><div class="stag">All Responses</div><div class="stitle" style="margin-bottom:0">Response Explorer</div></div>
    <div style="display:flex;gap:7px;flex-wrap:wrap">
      <select id="rf-p" onchange="renderResp()" style="background:var(--card);border:1px solid var(--border2);color:var(--text);padding:7px 10px;border-radius:6px;font-family:'JetBrains Mono',monospace;font-size:9px;cursor:pointer;outline:none"><option value="all">All Periods</option></select>
      <select id="rf-r" onchange="renderResp()" style="background:var(--card);border:1px solid var(--border2);color:var(--text);padding:7px 10px;border-radius:6px;font-family:'JetBrains Mono',monospace;font-size:9px;cursor:pointer;outline:none"><option value="all">All Regions</option><option>PK Zone</option><option>PK Non-Zone</option><option>India</option><option>ROW</option></select>
      <select id="rf-c" onchange="renderResp()" style="background:var(--card);border:1px solid var(--border2);color:var(--text);padding:7px 10px;border-radius:6px;font-family:'JetBrains Mono',monospace;font-size:9px;cursor:pointer;outline:none"><option value="all">All Categories</option><option value="promoter">Promoters</option><option value="passive">Passives</option><option value="detractor">Detractors</option></select>
      <button class="btn-sm" onclick="exportCSV()">Export CSV</button>
    </div>
  </div>
  <div id="resp-con" class="tw" style="margin-top:12px"><div class="empty">No responses</div></div>
</div>

</div><!-- .page -->
<div class="toast" id="toast"></div>

<script>
if(sessionStorage.getItem('nps_role')!=='admin') window.location.href='/';
function logout(){sessionStorage.removeItem('nps_role');window.location.href='/';}

// ‚îÄ‚îÄ‚îÄ AUTHORITATIVE PERIOD DATA (from Jan 2026 report) ‚îÄ‚îÄ‚îÄ
const PERIODS = [
  {period:'Sep 2025', nps:-10, total:203, pro:Math.round(203*.33), pass:Math.round(203*.24), det:Math.round(203*.43)},
  {period:'Nov 2025', nps:4,   total:84,  pro:Math.round(84*.357), pass:Math.round(84*.321), det:Math.round(84*.321)},
  {period:'Jan 2026', nps:1,   total:147, pro:53, pass:43, det:51},
];

// ‚îÄ‚îÄ‚îÄ NAMED JAN 2026 RESPONSES (verbatim from report) ‚îÄ‚îÄ‚îÄ
const JAN_NAMED = [
  {seller:'asian-trader',     score:3, comment:'We have encountered significant recurring challenges concerning payouts and unsubstantiated claims, with ~95% of issues remaining unresolved.',department:'Seller Support',region:'PK Non-Zone',period:'Jan 2026'},
  {seller:'ajb_thrift',       score:5, comment:'You should not support only customers. Listen to vendor perspective too.',department:'Seller Support',region:'PK Non-Zone',period:'Jan 2026'},
  {seller:'ss-thrift-store',  score:3, comment:'Fleek always gave favor to customer even if its not seller fault.',department:'Seller Support',region:'PK Non-Zone',period:'Jan 2026'},
  {seller:'aesthetic-clothing',score:5,comment:'Customer blackmail us then we refund or they make bad review.',department:'Refund Policy',region:'PK Non-Zone',period:'Jan 2026'},
  {seller:'legacy',           score:3, comment:'QC puts every piece in B/C grade. This is vintage, not new items.',department:'Quality Check',region:'PK Non-Zone',period:'Jan 2026'},
  {seller:'real-vintage',     score:5, comment:'QC cannot tell difference between original and fake. Authentic bags marked fake.',department:'Quality Check',region:'PK Non-Zone',period:'Jan 2026'},
  {seller:'drip-uz',          score:6, comment:'QC grading inconsistent with market norms.',department:'Quality Check',region:'PK Non-Zone',period:'Jan 2026'},
  {seller:'rich-style',       score:4, comment:'Seller support. There is no seller support.',department:'Seller Support',region:'PK Non-Zone',period:'Jan 2026'},
  {seller:'sades-vintage',    score:5, comment:'In all refunds, I have NEVER seen Fleek listen to seller perspective.',department:'Refund Policy',region:'PK Non-Zone',period:'Jan 2026'},
  {seller:'palekars-vintage', score:6, comment:'Fleek does not value sellers. Guide your staff how to talk with sellers.',department:'Seller Support',region:'PK Non-Zone',period:'Jan 2026'},
  {seller:'gigsvinto',        score:1, comment:'100% Payout hold for 2 months. No authentic reason given.',department:'Payments',region:'PK Non-Zone',period:'Jan 2026'},
  {seller:'the-vintage-street',score:6,comment:'We give 15% commission. Timely payouts we expect in return.',department:'Payments',region:'PK Non-Zone',period:'Jan 2026'},
  {seller:'global-choice',    score:2, comment:'No payment after 20+ days. ¬£199 product, payout marked as zero.',department:'Payments',region:'PK Non-Zone',period:'Jan 2026'},
  {seller:'shop-thrift-flow', score:5, comment:'50/50 payment split unfair when orders take a month to reach buyers.',department:'Payments',region:'PK Non-Zone',period:'Jan 2026'},
  {seller:'vintage-voyage',   score:6, comment:'No notifications for cancelled orders. No notifications from support in app.',department:'Vendor App',region:'PK Non-Zone',period:'Jan 2026'},
  {seller:'deja-vu-collective',score:4,comment:'App issues that have been there for 2 years.',department:'Vendor App',region:'PK Non-Zone',period:'Jan 2026'},
  {seller:'meral-vintage',    score:6, comment:'Lots of errors. App not working well. That is why people uninstall.',department:'Vendor App',region:'PK Non-Zone',period:'Jan 2026'},
  {seller:'thrift-up-1',      score:5, comment:'App has lot of glitches. Algorithm very bad for newcomers.',department:'Vendor App',region:'PK Non-Zone',period:'Jan 2026'},
  {seller:'uind-vintage',     score:5, comment:'Algorithm feels biased towards existing large sellers.',department:'Sales & Visibility',region:'PK Non-Zone',period:'Jan 2026'},
  {seller:'meer-vintage-1',   score:5, comment:'You focus on big vendors. Give small vendors a chance to grow.',department:'Sales & Visibility',region:'PK Non-Zone',period:'Jan 2026'},
  {seller:'old-money-apparel',score:1, comment:'My store not visible. You put my store on ghost mode.',department:'Sales & Visibility',region:'PK Non-Zone',period:'Jan 2026'},
];

// Dynamic data (from CSV uploads + form submissions)
let dynData = [];

function loadData(){
  try{ dynData = JSON.parse(localStorage.getItem('fleek_dyn')||'[]'); }catch(e){ dynData=[]; }
  rebuildCharts();
  renderHistory();
  renderUploadLog();
  renderResp();
  renderGeo();
}
function saveData(){ localStorage.setItem('fleek_dyn', JSON.stringify(dynData)); }

// Combined view: periods have authoritative NPS; individual responses from named + dyn
function allResponses(){ return [...JAN_NAMED, ...dynData]; }

function getPeriodList(){
  const base = PERIODS.map(p=>p.period);
  const extra = [...new Set(dynData.map(r=>r.period).filter(p=>!base.includes(p)))];
  const ORDER=['Sep 2025','Oct 2025','Nov 2025','Dec 2025','Jan 2026','Feb 2026','Mar 2026','Apr 2026','May 2026'];
  return [...base,...extra].sort((a,b)=>{const ia=ORDER.indexOf(a),ib=ORDER.indexOf(b);return ia!==-1&&ib!==-1?ia-ib:a.localeCompare(b);});
}

function getPeriodNPS(p){
  const auth = PERIODS.find(x=>x.period===p);
  if(auth) return auth;
  const rows = dynData.filter(r=>r.period===p);
  if(!rows.length) return {period:p,nps:0,total:0,pro:0,pass:0,det:0};
  const pro=rows.filter(r=>r.score>=9).length;
  const pass=rows.filter(r=>r.score>=7&&r.score<=8).length;
  const det=rows.filter(r=>r.score<=6).length;
  const total=rows.length;
  return {period:p,nps:Math.round(((pro-det)/total)*100),total,pro,pass,det};
}

// Overall NPS across ALL periods (334 total as per report = -3)
function calcOverall(){
  const all = PERIODS;
  const totPro = all.reduce((s,p)=>s+p.pro,0);
  const totDet = all.reduce((s,p)=>s+p.det,0);
  const tot = all.reduce((s,p)=>s+p.total,0);
  return {nps:Math.round(((totPro-totDet)/tot)*100),total:tot,pro:totPro,det:totDet,pass:tot-totPro-totDet};
}

let charts={};
function destroy(id){if(charts[id]){charts[id].destroy();delete charts[id];}}

function rebuildCharts(){
  applyFilter();
  renderGeo();
}

function applyFilter(){
  const pf=document.getElementById('pf').value;
  populatePeriodSelects();
  let stat;
  if(pf==='all'){
    stat=calcOverall();
    document.getElementById('cur-period').textContent='All Time';
    // NPS shown for all-time = -3 (from report), but stats aggregated from periods
  } else {
    stat=getPeriodNPS(pf);
    document.getElementById('cur-period').textContent=pf;
  }
  const fmt=v=>v===0?'0':v>0?'+'+v:String(v);
  const col=stat.nps>0?'var(--green)':stat.nps<0?'var(--red)':'var(--yellow)';
  document.getElementById('ov-nps').textContent=fmt(stat.nps);
  document.getElementById('ov-nps').style.color=col;
  document.getElementById('ov-ctx').textContent=pf==='all'?'Sep 2025 + Nov 2025 + Jan 2026':'n = '+stat.total+' respondents';
  document.getElementById('ov-pro').textContent=stat.total?stat.pro:'‚Äî';
  document.getElementById('ov-pro-s').textContent=stat.total?Math.round(stat.pro/stat.total*100)+'% promoters':'';
  document.getElementById('ov-pass').textContent=stat.total?stat.pass:'‚Äî';
  document.getElementById('ov-pass-s').textContent=stat.total?Math.round(stat.pass/stat.total*100)+'% passives':'';
  document.getElementById('ov-det').textContent=stat.total?stat.det:'‚Äî';
  document.getElementById('ov-det-s').textContent=stat.total?Math.round(stat.det/stat.total*100)+'% detractors':'';
  document.getElementById('ov-tot').textContent=stat.total||'‚Äî';

  // Jan 2026 dist chart (exact)
  const dist=[0,8,1,8,9,15,10,15,28,15,38]; // 0-10 from report
  destroy('distChart');
  charts.dist=new Chart(document.getElementById('distChart'),{
    type:'bar',
    data:{labels:['0','1','2','3','4','5','6','7','8','9','10'],datasets:[{data:dist,backgroundColor:dist.map((_,i)=>i>=9?'#3DD68C':i>=7?'#F5C518':'#E8453C'),borderRadius:4,borderSkipped:false}]},
    options:{plugins:{legend:{display:false},tooltip:{callbacks:{title:i=>'Score '+i[0].label,label:i=>i.raw+' responses'}}},scales:{x:{grid:{color:'rgba(255,255,255,.04)'},ticks:{color:'#666',font:{size:10}}},y:{beginAtZero:true,grid:{color:'rgba(255,255,255,.04)'},ticks:{color:'#666',font:{size:10},stepSize:5}}}}
  });

  // Jan 2026 segment donut
  destroy('segChart');
  charts.seg=new Chart(document.getElementById('segChart'),{
    type:'doughnut',
    data:{labels:['Promoters (53)','Passives (43)','Detractors (51)'],datasets:[{data:[53,43,51],backgroundColor:['#3DD68C','#F5C518','#E8453C'],borderWidth:0,hoverOffset:4}]},
    options:{plugins:{legend:{position:'bottom',labels:{color:'#999',boxWidth:9,padding:12,font:{family:'JetBrains Mono',size:9}}}},cutout:'64%'}
  });

  // Trend chart
  const pds=getPeriodList();
  const npsList=pds.map(p=>getPeriodNPS(p).nps);
  destroy('trendChart');
  charts.trend=new Chart(document.getElementById('trendChart'),{
    type:'line',
    data:{labels:pds,datasets:[{data:npsList,borderColor:'#F5C518',backgroundColor:'rgba(245,197,24,.07)',tension:.4,pointBackgroundColor:npsList.map(v=>v>=0?'#3DD68C':'#E8453C'),pointRadius:6,fill:true,borderWidth:2}]},
    options:{plugins:{legend:{display:false}},scales:{x:{grid:{color:'rgba(255,255,255,.04)'},ticks:{color:'#999',font:{size:9}}},y:{grid:{color:'rgba(255,255,255,.04)'},ticks:{color:'#666',font:{size:9}}}}}
  });
}

function renderGeo(){
  destroy('geoChart');
  charts.geo=new Chart(document.getElementById('geoChart'),{
    type:'bar',
    data:{labels:['PK Zone','PK Non-Zone','India & ROW'],datasets:[
      {label:'NPS',data:[-9,4,-14],backgroundColor:['rgba(232,69,60,.7)','rgba(61,214,140,.7)','rgba(232,69,60,.7)'],borderRadius:6}
    ]},
    options:{plugins:{legend:{display:false}},scales:{x:{grid:{color:'rgba(255,255,255,.04)'},ticks:{color:'#999',font:{size:10}}},y:{grid:{color:'rgba(255,255,255,.04)'},ticks:{color:'#666',font:{size:9}}}}}
  });
  destroy('gmvChart');
  charts.gmv=new Chart(document.getElementById('gmvChart'),{
    type:'doughnut',
    data:{labels:['PK Zone $164K','PK Non-Zone $748K','India & ROW $110K'],datasets:[{data:[164,748,110],backgroundColor:['#5B9EF5','#F5C518','#3DD68C'],borderWidth:0}]},
    options:{plugins:{legend:{position:'bottom',labels:{color:'#999',boxWidth:9,padding:10,font:{size:9}}}},cutout:'58%'}
  });
  destroy('deptChart');
  charts.dept=new Chart(document.getElementById('deptChart'),{
    type:'bar',
    data:{labels:['Seller Support','Quality Check','Refund Policy','Payments','Vendor App','Shipping','Sales & Vis.'],datasets:[{data:[-18,-5,-22,10,-20,40,10],backgroundColor:[-18,-5,-22,10,-20,40,10].map(v=>v>=0?'rgba(61,214,140,.7)':'rgba(232,69,60,.7)'),borderRadius:4}]},
    options:{plugins:{legend:{display:false}},scales:{x:{grid:{color:'rgba(255,255,255,.04)'},ticks:{color:'#999',font:{size:9},maxRotation:30}},y:{grid:{color:'rgba(255,255,255,.04)'},ticks:{color:'#666',font:{size:9}}}}}
  });
}

function renderHistory(){
  const pds=getPeriodList();
  const fmt=v=>v===0?'0':v>0?'+'+v:String(v);
  const rows=pds.map(p=>{
    const d=getPeriodNPS(p);
    const col=d.nps>0?'var(--green)':d.nps<0?'var(--red)':'var(--yellow)';
    const source=PERIODS.find(x=>x.period===p)?'<span style="background:rgba(245,197,24,.12);color:var(--yellow);font-family:JetBrains Mono,monospace;font-size:8px;padding:2px 6px;border-radius:3px">REPORT</span>':'<span style="background:var(--green-dim);color:var(--green);font-family:JetBrains Mono,monospace;font-size:8px;padding:2px 6px;border-radius:3px">IMPORTED</span>';
    return `<tr><td style="font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--muted)">${p}</td><td style="font-family:'Bebas Neue',sans-serif;font-size:20px;color:${col}">${fmt(d.nps)}</td><td>${d.total}</td><td style="color:var(--green)">${d.pro} (${d.total?Math.round(d.pro/d.total*100):0}%)</td><td style="color:var(--yellow)">${d.pass} (${d.total?Math.round(d.pass/d.total*100):0}%)</td><td style="color:var(--red)">${d.det} (${d.total?Math.round(d.det/d.total*100):0}%)</td><td>${source}</td></tr>`;
  }).join('');
  // Show overall
  const ov=calcOverall();
  const ovRow=`<tr style="background:rgba(245,197,24,.04)"><td style="font-family:'Bebas Neue',sans-serif;font-size:13px;letter-spacing:1px;color:var(--yellow)">OVERALL</td><td style="font-family:'Bebas Neue',sans-serif;font-size:20px;color:var(--red)">‚Äì3</td><td>${ov.total}</td><td style="color:var(--green)">${ov.pro}</td><td style="color:var(--yellow)">${ov.pass}</td><td style="color:var(--red)">${ov.det}</td><td style="font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--muted)">All periods</td></tr>`;
  document.getElementById('hist-tbl').innerHTML='<table><thead><tr><th>Period</th><th>NPS</th><th>Total</th><th>Promoters</th><th>Passives</th><th>Detractors</th><th>Source</th></tr></thead><tbody>'+rows+ovRow+'</tbody></table>';

  const pds2=getPeriodList();
  const npsList=pds2.map(p=>getPeriodNPS(p).nps);
  destroy('histChart');
  charts.hist=new Chart(document.getElementById('histChart'),{
    type:'line',
    data:{labels:pds2,datasets:[{label:'NPS',data:npsList,borderColor:'#F5C518',backgroundColor:'rgba(245,197,24,.08)',tension:.4,pointBackgroundColor:npsList.map(v=>v>=0?'#3DD68C':'#E8453C'),pointRadius:6,fill:true,borderWidth:2}]},
    options:{plugins:{legend:{display:false},annotation:{annotations:{overall:{type:'line',yMin:-3,yMax:-3,borderColor:'rgba(232,69,60,.4)',borderWidth:1,borderDash:[4,4]}}}},scales:{x:{grid:{color:'rgba(255,255,255,.04)'},ticks:{color:'#999',font:{size:9}}},y:{grid:{color:'rgba(255,255,255,.04)'},ticks:{color:'#666',font:{size:9}}}}}
  });
}

function populatePeriodSelects(){
  const pds=getPeriodList();
  ['pf','rf-p'].forEach(id=>{
    const sel=document.getElementById(id); if(!sel) return;
    const cur=sel.value;
    sel.innerHTML='<option value="all">All Periods</option>';
    pds.forEach(p=>{const o=document.createElement('option');o.value=p;o.textContent=p;sel.appendChild(o);});
    if(cur) sel.value=cur;
  });
}

function renderResp(){
  const pf=document.getElementById('rf-p').value;
  const rf=document.getElementById('rf-r').value;
  const cf=document.getElementById('rf-c').value;
  let rows=allResponses();
  if(pf!=='all') rows=rows.filter(r=>r.period===pf);
  if(rf!=='all') rows=rows.filter(r=>r.region===rf);
  if(cf==='promoter') rows=rows.filter(r=>r.score>=9);
  else if(cf==='passive') rows=rows.filter(r=>r.score>=7&&r.score<=8);
  else if(cf==='detractor') rows=rows.filter(r=>r.score<=6);
  const con=document.getElementById('resp-con');
  if(!rows.length){con.innerHTML='<div class="empty">No responses match filters</div>';return;}
  const cat=s=>s>=9?'pro':s>=7?'pas':'det';
  const catLabel=s=>s>=9?'promoter':s>=7?'passive':'detractor';
  const catCol=s=>s>=9?'var(--green)':s>=7?'var(--yellow)':'var(--red)';
  con.innerHTML='<div style="padding:8px 12px;font-family:JetBrains Mono,monospace;font-size:8px;color:var(--muted);border-bottom:1px solid var(--border)">'+rows.length+' RESPONSES</div><table><thead><tr><th>Seller</th><th>Score</th><th>Category</th><th>Region</th><th>Dept</th><th>Period</th><th>Comment</th></tr></thead><tbody>'+
    rows.map(r=>`<tr><td style="font-weight:700">${r.seller||'‚Äî'}</td><td style="font-family:'Bebas Neue',sans-serif;font-size:17px;color:${catCol(r.score)}">${r.score}</td><td><span class="bdg b-${cat(r.score)}">${catLabel(r.score)}</span></td><td style="font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--muted)">${r.region||'‚Äî'}</td><td style="font-size:10px;color:var(--muted)">${r.department||'‚Äî'}</td><td style="font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--subtle)">${r.period||'‚Äî'}</td><td style="font-size:10px;color:var(--muted);max-width:260px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" title="${r.comment||''}">${r.comment||'‚Äî'}</td></tr>`).join('')+
  '</tbody></table>';
}

// CSV
let parsedCSV=[],pendingFile='';
function ev(e){e.preventDefault();document.getElementById('uz').classList.add('drag');}
function drop(e){e.preventDefault();document.getElementById('uz').classList.remove('drag');const f=e.dataTransfer.files[0];if(f)handleCSV(f);}
function handleCSV(file){
  if(!file) return; pendingFile=file.name;
  const r=new FileReader();
  r.onload=e=>{
    const lines=e.target.result.trim().split(/\r?\n/);
    const hdrs=lines[0].split(',').map(h=>h.trim().toLowerCase().replace(/['"]/g,''));
    parsedCSV=lines.slice(1).map(l=>{
      const c=l.split(',').map(x=>x.trim().replace(/^"|"$/g,''));
      const o={};hdrs.forEach((h,i)=>o[h]=c[i]||'');
      return{seller:o.seller||o.name||o.vendor||'Unknown',score:parseInt(o.score)||0,comment:o.comment||'',department:o.department||o.dept||'',region:o.region||'PK Non-Zone',period:o.period||o.month||'Imported'};
    }).filter(r=>r.score>=0&&r.score<=10);
    const pro=parsedCSV.filter(r=>r.score>=9).length, det=parsedCSV.filter(r=>r.score<=6).length, tot=parsedCSV.length;
    const nps=tot?Math.round(((pro-det)/tot)*100):0;
    document.getElementById('prev-title').textContent=`${file.name} ¬∑ ${tot} rows ¬∑ NPS ${nps>=0?'+':''}${nps}`;
    const lim=parsedCSV.slice(0,8);
    document.getElementById('prev-tbl').innerHTML='<table><thead><tr><th>Seller</th><th>Score</th><th>Region</th><th>Dept</th><th>Period</th><th>Comment</th></tr></thead><tbody>'+
      lim.map(r=>`<tr><td>${r.seller}</td><td style="color:${r.score>=9?'var(--green)':r.score>=7?'var(--yellow)':'var(--red)'}">${r.score}</td><td style="font-family:'JetBrains Mono',monospace;font-size:8px">${r.region}</td><td style="font-size:10px">${r.department||'‚Äî'}</td><td style="font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--subtle)">${r.period}</td><td style="font-size:10px;color:var(--muted)">${r.comment.substring(0,50)||'‚Äî'}</td></tr>`).join('')+
      (parsedCSV.length>8?'<tr><td colspan="6" style="text-align:center;color:var(--subtle);font-size:9px;padding:10px">...+'+(parsedCSV.length-8)+' more rows</td></tr>':'')+
    '</tbody></table>';
    document.getElementById('upload-prev').style.display='block';
  };
  r.readAsText(file);
}
function confirmUpload(){
  if(!parsedCSV.length) return;
  dynData=[...dynData,...parsedCSV];
  saveData();
  const periods=[...new Set(parsedCSV.map(r=>r.period))];
  const pro=parsedCSV.filter(r=>r.score>=9).length,det=parsedCSV.filter(r=>r.score<=6).length;
  const nps=Math.round(((pro-det)/parsedCSV.length)*100);
  const log=JSON.parse(localStorage.getItem('fleek_uplog')||'[]');
  log.push({file:pendingFile,period:periods.join(', '),rows:parsedCSV.length,nps,date:new Date().toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})});
  localStorage.setItem('fleek_uplog',JSON.stringify(log));
  parsedCSV=[];
  document.getElementById('upload-prev').style.display='none';
  document.getElementById('fi').value='';
  showToast('‚úì '+log[log.length-1].rows+' responses imported');
  loadData();
}
function renderUploadLog(){
  const log=JSON.parse(localStorage.getItem('fleek_uplog')||'[]');
  document.getElementById('up-count').textContent=log.length+' upload'+(log.length!==1?'s':'');
  const el=document.getElementById('up-log');
  if(!log.length){el.innerHTML='<div class="empty">No uploads yet</div>';return;}
  el.innerHTML='<table><thead><tr><th>File</th><th>Period</th><th>Rows</th><th>NPS</th><th>Date</th></tr></thead><tbody>'+
    [...log].reverse().map(l=>`<tr><td>${l.file}</td><td style="font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--muted)">${l.period}</td><td>${l.rows}</td><td style="font-family:'Bebas Neue',sans-serif;font-size:17px;color:${l.nps>=0?'var(--green)':'var(--red)'}">${l.nps>=0?'+':''}${l.nps}</td><td style="font-family:'JetBrains Mono',monospace;font-size:8px;color:var(--subtle)">${l.date}</td></tr>`).join('')+
  '</tbody></table>';
}

function exportCSV(){
  const rows=allResponses();
  const csv='seller,score,category,region,department,period,comment\n'+rows.map(r=>{const cat=r.score>=9?'promoter':r.score>=7?'passive':'detractor';return[r.seller,r.score,cat,r.region||'',r.department||'',r.period||'','"'+(r.comment||'').replace(/"/g,'""')+'"'].join(',');}).join('\n');
  const a=document.createElement('a');a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(csv);a.download='fleek-nps-export.csv';a.click();
}

function sw(t){
  document.querySelectorAll('.ntab').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.tc').forEach(c=>c.classList.remove('active'));
  document.getElementById('nt-'+t).classList.add('active');
  document.getElementById('tab-'+t).classList.add('active');
  if(t==='history') renderHistory();
  if(t==='upload') renderUploadLog();
  if(t==='responses') renderResp();
  if(t==='geo') renderGeo();
  if(t==='departments') { destroy('deptChart'); renderGeo(); }
}

function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),3000);}

loadData();
</script>
</body>
</html>